<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="author" content="Florian Le Bourdais">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <title>A Probabilistic Model for Ingredients in the Kaggle What's Cooking Challenge | Frolian's blog</title>

	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link rel="alternate" type="application/atom+xml" title="Frolian's blog blog atom feed" href="/feeds/all.atom.xml" />
        <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="/theme/css/icons.css"/>
        <style>.highlight .hll { background-color: #ffffcc }
.highlight .c { color: #60a0b0; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #007020; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #007020 } /* Comment.Preproc */
.highlight .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.highlight .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #007020 } /* Keyword.Pseudo */
.highlight .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #902000 } /* Keyword.Type */
.highlight .m { color: #40a070 } /* Literal.Number */
.highlight .s { color: #4070a0 } /* Literal.String */
.highlight .na { color: #4070a0 } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.highlight .no { color: #60add5 } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #007020 } /* Name.Exception */
.highlight .nf { color: #06287e } /* Name.Function */
.highlight .nl { color: #002070; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #062873; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #bb60d5 } /* Name.Variable */
.highlight .ow { color: #007020; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #40a070 } /* Literal.Number.Float */
.highlight .mh { color: #40a070 } /* Literal.Number.Hex */
.highlight .mi { color: #40a070 } /* Literal.Number.Integer */
.highlight .mo { color: #40a070 } /* Literal.Number.Oct */
.highlight .sb { color: #4070a0 } /* Literal.String.Backtick */
.highlight .sc { color: #4070a0 } /* Literal.String.Char */
.highlight .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #4070a0 } /* Literal.String.Double */
.highlight .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #4070a0 } /* Literal.String.Heredoc */
.highlight .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.highlight .sx { color: #c65d09 } /* Literal.String.Other */
.highlight .sr { color: #235388 } /* Literal.String.Regex */
.highlight .s1 { color: #4070a0 } /* Literal.String.Single */
.highlight .ss { color: #517918 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #bb60d5 } /* Name.Variable.Class */
.highlight .vg { color: #bb60d5 } /* Name.Variable.Global */
.highlight .vi { color: #bb60d5 } /* Name.Variable.Instance */
.highlight .il { color: #40a070 } /* Literal.Number.Integer.Long */</style>
        <style>body {
  margin: 0;
  padding: 0;
  font: 15px 'Source Sans Pro', sans-serif;
  line-height: 1.6em;
  color: #222;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
}
a {
  color: #007EE5;
  text-decoration: none;
}
a:hover {
  color: #007EE5;
  text-decoration: none;
}
header.main-header {
  background: none repeat scroll 0% 0% #205F29;
  margin-bottom: 0px;
}
header.main-header a {
  color: #fff;
}
header.main-header .container {
  max-width: 1000px;
}
header.main-header .container nav a:hover {
  background-color: #5C881C;
}
article {
  margin: 0;
}
article header.about {
  margin-bottom: 0px;
  padding-bottom: 0px;
}
article header {
  margin-bottom: 20px;
  padding-bottom: 20px;
}
article header h1 {
  margin-bottom: 2px;
  font-weight: 700;
  color: #000;
}
article header time {
  color: #9E9E9E;
  font-size: 0.85em;
  float: right;
}
article header time.left {
  color: #9E9E9E;
  font-size: 0.85em;
  float: left;
}
article div.social-links ul {
  padding: 0px;
}
article div.social-links li {
  display: inline;
  font-size: 20px;
}
article div.social-links li a {
  color: #000;
  padding: 10px;
}
article div.social-links li a:hover {
  color: #666;
  text-decoration: none;
}
article p {
  font-size: 16px;
  margin-bottom: 20px;
  line-height: 1.6em;
}
article p.note {
  background: #f5f5f5;
  border: 1px solid #ddd;
  padding: 0.533em 0.733em;
}
article p.update {
  background-color: #FEEFB3;
  border: 1px solid #e6e68a;
  padding: 0.533em 0.733em;
}
article p.alert {
  background-color: #ffe2e2;
  border: 1px solid #ffb2b2;
  padding: 0.533em 0.733em;
}
article ul,
article ol {
  margin-top: 0px;
  margin-bottom: 25px;
}
article li {
  font-size: 16px;
  line-height: 1.6em;
}
article a:hover {
  text-decoration: underline;
}
article blockquote {
  border-left: 2px solid #c7c7cc;
  color: #666;
  margin: 30px 0;
  padding: 0 0 0 25px;
}
article img {
  max-width: 100%;
}
article code {
  color: #333;
  background-color: #EEE;
  border-radius: 0;
  font-size: 13px;
}
article .meta {
  font-size: 11px;
}
article .meta a:hover {
  text-decoration: none;
}
article .meta div {
  margin-bottom: 20px;
  display: block;
}
article header a.tag {
  padding: 1px 12px;
  display: inline-block;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.8);
  background: rgba(0, 0, 0, 0.05);
}
article header a.tag:hover{
  background: rgba(0, 0, 0, 0.15);
  text-decoration: none;
}
article .meta a.tag {
  margin: 0 10px 10px 0;
  padding: 1px 12px;
  display: inline-block;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.8);
  background: rgba(0, 0, 0, 0.05);
}
article .meta a.tag:hover {
  background: rgba(0, 0, 0, 0.15);
}
article .meta a.read_more,
article .meta a.comments_btn {
  font-size: 14px;
  font-weight: 800;
  padding: 10px 20px;
  color: #205F29;
  background: #FFF;
  border: 1px solid #205F29;
}
article .meta a.read_more:hover,
article .meta a.comments_btn:hover {
  color: #FFF;
  background: #5C881C;
}
.index {
  max-width: 800px;
}
.index article header h2 {
  font-size: 36px;
  margin-bottom: 2px;
  font-weight: 700;
}
.index article header h2 a {
  color: #000;
}
.index article header h2 a:hover {
  color: #007EE5;
  text-decoration: none;
}
.index .separator {
  padding: 40px 0 0 0;
  margin: 0 0 40px 0;
  height: 10px;
  border-bottom: solid 1px #CCC;
}
.index .pagination {
  display: block;
  margin-bottom: 100px;
}
.index .pagination .left {
  text-align: right;
}
.index .pagination .right {
  text-align: left;
}
.index .pagination a {
  display: inline-block;
  border: 2px solid #5C881C;
  margin: 0 5px;
  padding: 8px 20px;
  font-weight: bold;
  color: #5C881C;
}
.index .pagination a:hover {
  color: #FFF;
  background: #5C881C;
}
.post {
  max-width: 800px;
}
.post h2:before {
  content: "# ";
  font-weight: bold;
  color: #DDD;
}
.post h3:before {
  content: "## ";
  font-weight: bold;
  color: #DDD;
}
.post h4:before {
  content: "### ";
  font-weight: bold;
  color: #DDD;
}
.post article .meta {
  margin: 50px 0 50px;
}
.list {
  max-width: 800px;
}
.list ul.double-list {
  margin: 0 auto 60px;
  padding: 0;
  list-style-type: none;
}
.list ul.double-list li {
  padding: 5px 0;
}
.list ul.double-list li h2 {
  font-size: 1em;
  display: inline;
  font-weight: normal;
}
.list ul.double-list li span {
  font-family: sans-serif;
  text-transform: uppercase;
  text-align: right;
  float: right;
  padding-top: 3px;
  font-size: 12px;
  color: #999;
}
.full-width-content {
  padding-top: 10px;
  padding-left: 0px;
  padding-right: 0px;
  margin-left: -20px;
  margin-right: -20px;
}
.col-xs-1,
.col-sm-1,
.col-md-1,
.col-lg-1,
.col-xs-2,
.col-sm-2,
.col-md-2,
.col-lg-2,
.col-xs-3,
.col-sm-3,
.col-md-3,
.col-lg-3,
.col-xs-4,
.col-sm-4,
.col-md-4,
.col-lg-4,
.col-xs-5,
.col-sm-5,
.col-md-5,
.col-lg-5,
.col-xs-6,
.col-sm-6,
.col-md-6,
.col-lg-6,
.col-xs-7,
.col-sm-7,
.col-md-7,
.col-lg-7,
.col-xs-8,
.col-sm-8,
.col-md-8,
.col-lg-8,
.col-xs-9,
.col-sm-9,
.col-md-9,
.col-lg-9,
.col-xs-10,
.col-sm-10,
.col-md-10,
.col-lg-10,
.col-xs-11,
.col-sm-11,
.col-md-11,
.col-lg-11,
.col-xs-12,
.col-sm-12,
.col-md-12,
.col-lg-12 {
  padding-right: 0px;
  padding-left: 0px;
}
.featured-image {
  display: block;
  margin-left: auto;
  margin-right: auto;
  max-height: 350px;
}

/* These two styles allow my Twitter and Github icons to match the them */

.inverted-svg {
  filter: invert(50%);
}

.inverted-svg:hover {
  filter: invert(100%);
}

/* Blog subtitle styling */

.blog-subtitle {
  font-size: 10px;
  font-style: italic;
  padding-left: 5px;
  padding-right: 5px;
}


/* These elements allow me to configure my sharing icons */

.share ul {
  text-align: right;
}

.share li {
  display: inline;
  padding: 0 5px;
}

.share img {
  width: 2em;
}</style>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


    </head>

    <body>
        <header class="navbar navbar-inverse bs-docs-nav">
            <div class="container-fluid">
                <div class="navbar-header">
		  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#theNavbar">
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span> 
		  </button>
                  <a class="navbar-brand" href="/" title="Home" class="title">Frolian's blog</a>
                  <span class='navbar-brand blog-subtitle'>standing on the shoulders of PyGiants</span>
                </div>
                <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation" id="theNavbar">
		    <ul class="nav navbar-nav navbar-right">
                        <li><a href="https://github.com/flothesof" target="_blank" title="Look at my GitHub">
                            <svg viewBox="0 0 18 16" style="width: 20px; height: 20px;" class="inverted-svg">
                              <g>
                                <path d="M8 0C3.58 0 0 3.582 0 8c0 3.535 2.292 6.533 5.47 7.59.4.075.547-.172.547-.385 0-.19-.007-.693-.01-1.36-2.226.483-2.695-1.073-2.695-1.073-.364-.924-.89-1.17-.89-1.17-.725-.496.056-.486.056-.486.803.056 1.225.824 1.225.824.714 1.223 1.873.87 2.33.665.072-.517.278-.87.507-1.07-1.777-.2-3.644-.888-3.644-3.953 0-.873.31-1.587.823-2.147-.083-.202-.358-1.015.077-2.117 0 0 .672-.215 2.2.82.638-.178 1.323-.266 2.003-.27.68.004 1.364.092 2.003.27 1.527-1.035 2.198-.82 2.198-.82.437 1.102.163 1.915.08 2.117.513.56.823 1.274.823 2.147 0 3.073-1.87 3.75-3.653 3.947.287.246.543.735.543 1.48 0 1.07-.01 1.933-.01 2.195 0 .215.144.463.55.385C13.71 14.53 16 11.534 16 8c0-4.418-3.582-8-8-8"></path>
                              </g>
                            </svg>
                        </a></li>
                        <li><a href="https://twitter.com/frolianlb" target="_blank" title="Follow me on Twitter">
                            <svg viewBox="0 0 18 16" style="width: 20px; height: 20px;" class="inverted-svg">
                              <g>
                                <path d="M16 3.038c-.59.26-1.22.437-1.885.517.677-.407 1.198-1.05 1.443-1.816-.634.375-1.337.648-2.085.795-.598-.638-1.45-1.036-2.396-1.036-1.812 0-3.282 1.468-3.282 3.28 0 .258.03.51.085.75C5.152 5.39 2.733 4.084 1.114 2.1.83 2.583.67 3.147.67 3.75c0 1.14.58 2.143 1.46 2.732-.538-.017-1.045-.165-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.22-.276.074-.566.114-.865.114-.21 0-.416-.02-.617-.058.418 1.304 1.63 2.253 3.067 2.28-1.124.88-2.54 1.404-4.077 1.404-.265 0-.526-.015-.783-.045 1.453.93 3.178 1.474 5.032 1.474 6.038 0 9.34-5 9.34-9.338 0-.143-.004-.284-.01-.425.64-.463 1.198-1.04 1.638-1.7z" fill-rule="nonzero"></path>
                              </g>
                            </svg>
                        </a></li>
                            <li><a href="pages/about.html" title="About">About</a></li>
                            <li><a href="/archives.html" title="Archive">Archive</a></li>
                            <li><a class="nodec icon-rss" href="rss.xml" title="flothesof.github.io RSS feed" rel="me"></a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <div id="wrap">
<div class="container post">
    <article>
        <header>
            <h1>A Probabilistic Model for Ingredients in the Kaggle What's Cooking Challenge</h1>
			<time datetime="article.date.isoformat()" pubdate>Wed, 02 Mar 2016</time>			
			<div>
					<a href="http://flothesof.github.io/tag/machine-learning.html" class="tag">Machine Learning</a>
					<a href="http://flothesof.github.io/tag/probability.html" class="tag">Probability</a>
			</div>
        </header>

        <div class="article_content">
            <div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>In this notebook, we'll try to solve to a problem that arose when I was working on the Kaggle What's Cooking challenge (see my previous posts on the subject <a href="http://flothesof.github.io/kaggle-whats-cooking-machine-learning.html">here</a> and <a href="http://flothesof.github.io/kaggle-whatscooking-bokeh-plots.html">here</a>).</p>
<p>In this challenge, the data, which consists of recipes, contains a few quirks. For example, the data may contain names of brands  such as <em>knorr garlic minicub</em>, or mention weights and quantities that should have been cleaned up beforehand <em>(10 oz.) frozen chopped spinach, thawed and squeezed dry</em>.</p>
<p>The goal of this notebook is therefore to develop a method that suggests better ingredient names in an automatic way, based on a given recipe.</p>
<p>The outline of this blog post is as follows: we will first look at some overall statistics about the data, then develop a probabilistic model inspired by the principle behind spellcheckers and google auto-correct as explained by <a href="http://norvig.com/spell-correct.html">Peter Norvig</a> and finally apply it to the machine learning algorithm used in the previous posts, the logistic regression.</p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Statistics-about-the-data,-at-ingredient-and-word-level">Statistics about the data, at ingredient and word level<a class="anchor-link" href="#Statistics-about-the-data,-at-ingredient-and-word-level">&#182;</a></h1>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>In this section, we'll do some basic data exploration. In particular, let's try to answer the following questions:</p>
<ul>
<li>how many ingredients do we find in the data? how many are unique?</li>
<li>how many individual words make up these ingredients?</li>
</ul>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>First, let's load the data. We read it using codecs because pandas hasn't support for specifying encoding in the json loading routine (see <a href="http://blog.nexusger.de/2015/11/python-pandas-and-json_read-with-utf-8-encoding/">http://blog.nexusger.de/2015/11/python-pandas-and-json_read-with-utf-8-encoding/</a>).</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[1]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[13]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;train.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>The head of the dataframe looks like this:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[14]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[14]:</div>



<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cuisine</th>
      <th>id</th>
      <th>ingredients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>greek</td>
      <td>10259</td>
      <td>[romaine lettuce, black olives, grape tomatoes...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>southern_us</td>
      <td>25693</td>
      <td>[plain flour, ground pepper, salt, tomatoes, g...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>filipino</td>
      <td>20130</td>
      <td>[eggs, pepper, salt, mayonaise, cooking oil, g...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>indian</td>
      <td>22213</td>
      <td>[water, vegetable oil, wheat, salt]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>indian</td>
      <td>13162</td>
      <td>[black pepper, shallots, cornflour, cayenne pe...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Now, let's build a single list with all the ingredients found in the dataset.</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[15]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_ingredients_text</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ingredient_list</span> <span class="ow">in</span> <span class="n">df_train</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
    <span class="n">all_ingredients_text</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ing</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">ing</span> <span class="ow">in</span> <span class="n">ingredient_list</span><span class="p">]</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's have a look at the stats. We have the following number of ingredients in our recipes:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[16]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">all_ingredients_text</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[16]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>428275</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Among those, the number of unique ingredients is:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[17]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_ingredients_text</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[17]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>6703</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>How about looking at these ingredients in terms of words? We can split each ingredient at a word boundary using a regexp and then count them:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[18]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[,. ]+&#39;</span><span class="p">),</span> <span class="s1">&#39;KRAFT Shredded Pepper Jack Cheese with a TOUCH OF PHILADELPHIA&#39;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[18]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>[&#39;KRAFT&#39;,
 &#39;Shredded&#39;,
 &#39;Pepper&#39;,
 &#39;Jack&#39;,
 &#39;Cheese&#39;,
 &#39;with&#39;,
 &#39;a&#39;,
 &#39;TOUCH&#39;,
 &#39;OF&#39;,
 &#39;PHILADELPHIA&#39;]</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's do that and compute the number of words and then the unique words:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[19]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">splitter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[,. ]+&#39;</span><span class="p">)</span>
<span class="n">all_words</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ingredient</span> <span class="ow">in</span> <span class="n">all_ingredients_text</span><span class="p">:</span>
    <span class="n">all_words</span> <span class="o">+=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">splitter</span><span class="p">,</span> <span class="n">ingredient</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[20]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">all_words</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[20]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>807802</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>How about unique ones?</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[21]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_words</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[21]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>3152</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>So to conclude, our dataset consists of:</p>
<ul>
<li>428275 ingredients</li>
<li>among which 6703 are unique</li>
<li>all these ingredients are made of 807802 words</li>
<li>among which 3152 are unique</li>
</ul>
<p>Let's now turn to the problems one can see with these ingredients.</p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Why-some-ingredients-found-in-the-data-are-strange">Why some ingredients found in the data are strange<a class="anchor-link" href="#Why-some-ingredients-found-in-the-data-are-strange">&#182;</a></h1>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>The longest ingredient names found in the dataset are:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[22]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_ingredients_text</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[22]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>[&#39;pillsbury™ crescent recipe creations® refrigerated seamless dough sheet&#39;,
 &#39;kraft mexican style shredded four cheese with a touch of philadelphia&#39;,
 &#39;bertolli vineyard premium collect marinara with burgundi wine sauc&#39;,
 &#39;kraft shredded pepper jack cheese with a touch of philadelphia&#39;,
 &#39;hidden valley® farmhouse originals italian with herbs dressing&#39;,
 &#39;hidden valley® original ranch salad® dressing &amp; seasoning mix&#39;,
 &#39;condensed reduced fat reduced sodium cream of mushroom soup&#39;,
 &#39;hellmannâ€™ or best food canola cholesterol free mayonnais&#39;,
 &#39;condensed reduced fat reduced sodium cream of chicken soup&#39;,
 &#34;i can&#39;t believ it&#39; not butter! made with olive oil spread&#34;,
 &#39;wish-bone light asian sesame ginger vinaigrette dressing&#39;,
 &#39;(10 oz.) frozen chopped spinach, thawed and squeezed dry&#39;,
 &#39;kraft mexican style 2% milk finely shredded four cheese&#39;,
 &#39;kraft shredded low-moisture part-skim mozzarella cheese&#39;,
 &#39;hurst family harvest chipotle lime black bean soup mix&#39;,
 &#39;reduced fat reduced sodium tomato and herb pasta sauce&#39;,
 &#39;frozen orange juice concentrate, thawed and undiluted&#39;,
 &#39;crystal farms reduced fat shredded marble jack cheese&#39;,
 &#34;i can&#39;t believe it&#39;s not butter!® all purpose sticks&#34;,
 &#39;sargento® traditional cut shredded mozzarella cheese&#39;,
 &#39;lipton sparkling diet green tea with strawberry kiwi&#39;,
 &#39;sargento® traditional cut shredded 4 cheese mexican&#39;,
 &#39;hidden valley® original ranch® spicy ranch dressing&#39;,
 &#39;hidden valley® greek yogurt original ranch® dip mix&#39;,
 &#39;conimex woksaus specials vietnamese gember knoflook&#39;,
 &#39;honeysuckle white® hot italian turkey sausage links&#39;,
 &#39;ragu old world style sweet tomato basil pasta sauc&#39;,
 &#39;sargento® artisan blends® shredded parmesan cheese&#39;,
 &#39;reduced fat reduced sodium cream of mushroom soup&#39;,
 &#39;frozen lemonade concentrate, thawed and undiluted&#39;,
 &#39;reduced sodium reduced fat cream of mushroom soup&#39;,
 &#39;condensed reduced fat reduced sodium tomato soup&#39;,
 &#39;shredded reduced fat reduced sodium swiss cheese&#39;,
 &#39;knorr reduc sodium chicken flavor bouillon cube&#39;,
 &#39;2 1/2 to 3 lb. chicken, cut into serving pieces&#39;,
 &#39;kraft mexican style finely shredded four cheese&#39;,
 &#39;frozen chopped spinach, thawed and squeezed dry&#39;,
 &#34;frank&#39;s® redhot® original cayenne pepper sauce&#34;,
 &#39;reduced sodium condensed cream of chicken soup&#39;,
 &#39;foster farms boneless skinless chicken breasts&#39;,
 &#39;knorr tomato bouillon with chicken flavor cube&#39;,
 &#39;pompeian canola oil and extra virgin olive oil&#39;,
 &#39;hidden valley® original ranch® light dressing&#39;,
 &#34;uncle ben&#39;s ready rice whole grain brown rice&#34;,
 &#39;soy vay® veri veri teriyaki® marinade &amp; sauce&#39;,
 &#39;taco bell® home originals® taco seasoning mix&#39;,
 &#39;pillsbury™ refrigerated crescent dinner rolls&#39;,
 &#39;kraft reduced fat shredded mozzarella cheese&#39;,
 &#39;reduced sodium italian style stewed tomatoes&#39;,
 &#39;skinless and boneless chicken breast fillet&#39;]</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>What's going on here? Several observations can be made from this ingredient list:</p>
<ul>
<li>some ingredients contain special symbols that are not relevant (trademark, copyright, ...)</li>
<li>some ingredients feature brand names, for instance <em>KRAFT, Pillsbury, Hidden Valley</em>, that I would say are not relevant to the identification of the ingredient itself and that I would thus want to exclude</li>
<li>some ingredients contain sentences of english words instead of ingredients <em>i can't believ it' not butter! made with olive oil spread</em></li>
<li>some ingredients contain spelling errors <em>burgundi wine sauc</em> should actually be spelled <em>burgundy wine sauce</em></li>
<li>some ingredients contain quantities of ingredients that shouldn't be there: <em>2 1/2 to 3 lb. chicken, cut into serving pieces</em></li>
</ul>
<p>Ideally, we want a function that returns a more relevant version of these ingredients. For example:</p>
<table>
<thead><tr>
<th>original ingredient</th>
<th>improved ingredient</th>
</tr>
</thead>
<tbody>
<tr>
<td>pillsbury™ crescent recipe creations® refrigerated seamless dough sheet</td>
<td>refrigerated seamless dough sheet</td>
</tr>
<tr>
<td>i can't believe it's not butter!® all purpose sticks</td>
<td>all purpose sticks</td>
</tr>
<tr>
<td>2 1/2 to 3 lb. chicken, cut into serving pieces</td>
<td>chicken pieces</td>
</tr>
</tbody>
</table>
<p>These suggested improved ingredients are not unique and depend upon the knowledge of the person formulating them. The problem is that they're not easy to systematically generate. Therefore, it would be great if we could use a model based on the data itself to suggest them. This is what we're going to do in the next section.</p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Building-a-simple-model">Building a simple model<a class="anchor-link" href="#Building-a-simple-model">&#182;</a></h1>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Theory">Theory<a class="anchor-link" href="#Theory">&#182;</a></h2>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Given an ingredient, we have a choice to throw out some of its components (i.e. words). Judging if a component of an ingredient is useful or not is difficult. However, by following <a href="http://norvig.com/spell-correct.html">Peter Norvig's approach on spell correcting</a> (or see these slides at Cornell University <a href="https://courses.cit.cornell.edu/info4300_2011fa/slides/25.pdf">https://courses.cit.cornell.edu/info4300_2011fa/slides/25.pdf</a> that explain Peter's approach in detail), we can formulate the problem of throwing out ingredient components in a probabilistic way. Although not stated in Norvig's writeup, this approach is close to something called a <a href="https://en.wikipedia.org/wiki/Naive_Bayes_classifier">Naive Bayes classifier</a>.</p>
<p>Let's take a closer look at what we want to do. We want our improved ingredient to maximize its probability given our input ingredient:</p>
$$
\DeclareMathOperator*{\argmax}{arg\,max}
\argmax_{b}P\left({b \mid i}\right)
$$<p>Here, I denoted by $b$ the better ingredient and by $i$ the original ingredient.</p>
<p>The previous expression can be transformed according to Bayes Rule (following Peter Norvig) to yield:</p>
$$
\argmax_{b} {P\left({i \mid b}\right) P(b) \over P(i)}
$$<p>Given that the ingredient $i$ is fixed, we neglect the denominator (as Peter does) and end up with:</p>
$$
\argmax_{b} P\left({i \mid b}\right) P(b)
$$<p>This leaves us with three terms that balance out:</p>
<ul>
<li>the probability of occurence of ingredient in our data $P(b)$ (this will favor commonly used ingredients)</li>
<li>the error model, which says how likely it is that the input ingredient $i$ is a modified version of the better ingredient $b$</li>
<li>the argmax, our control mechanism, which chooses the $b$ that gives the best combined probability score</li>
</ul>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Our error model will be that we can only delete words from our ingredient. So what we need is to generate a list of possible ingredients based on our original ingredient by substracting words. Also, we will assume that word order doesn't matter, so we can represent an ingredient by a set.</p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Modelling-ingredients-using-sets">Modelling ingredients using sets<a class="anchor-link" href="#Modelling-ingredients-using-sets">&#182;</a></h2>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><strong>Ingredients</strong> contain a fixed number of words. We will therefore model them as <strong>frozensets</strong> of <strong>words</strong>. This will allow us to manipulate them more easily in the remaining document.</p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's define a function that creates an ingredient from a text string:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[24]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">to_ingredient</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="s2">&quot;Transforms text into an ingredient.&quot;</span>
    <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[,. ]+&#39;</span><span class="p">),</span> <span class="n">text</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's build a list of all our ingredients using this function:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[25]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_ingredients</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_ingredient</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">all_ingredients_text</span><span class="p">]</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[26]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_ingredients</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[26]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>[frozenset({&#39;lettuce&#39;, &#39;romaine&#39;}),
 frozenset({&#39;black&#39;, &#39;olives&#39;}),
 frozenset({&#39;grape&#39;, &#39;tomatoes&#39;}),
 frozenset({&#39;garlic&#39;}),
 frozenset({&#39;pepper&#39;}),
 frozenset({&#39;onion&#39;, &#39;purple&#39;}),
 frozenset({&#39;seasoning&#39;}),
 frozenset({&#39;beans&#39;, &#39;garbanzo&#39;}),
 frozenset({&#39;cheese&#39;, &#39;crumbles&#39;, &#39;feta&#39;}),
 frozenset({&#39;flour&#39;, &#39;plain&#39;})]</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's now implement our algorithm given our model of an ingredient.</p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Implementation">Implementation<a class="anchor-link" href="#Implementation">&#182;</a></h2>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>We can now write a function that generates all possible candidate ingredients that can be built from a starting ingredient, using combinations found in the Python standard library.</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[27]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>

<span class="k">def</span> <span class="nf">candidates</span><span class="p">(</span><span class="n">ingredient</span><span class="p">):</span>
    <span class="s2">&quot;Returns a list of candidate ingredients obtained from the original ingredient by keeping at least one of them.&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingredient</span><span class="p">)</span>
    <span class="n">possible</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">possible</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">combi</span><span class="p">)</span> <span class="k">for</span> <span class="n">combi</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">ingredient</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">possible</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's see how this works on examples:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[28]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">candidates</span><span class="p">(</span><span class="n">to_ingredient</span><span class="p">(</span><span class="s2">&quot;tomato and herb pasta sauce&quot;</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[28]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>[frozenset({&#39;pasta&#39;}),
 frozenset({&#39;herb&#39;}),
 frozenset({&#39;sauce&#39;}),
 frozenset({&#39;and&#39;}),
 frozenset({&#39;tomato&#39;}),
 frozenset({&#39;herb&#39;, &#39;pasta&#39;}),
 frozenset({&#39;pasta&#39;, &#39;sauce&#39;}),
 frozenset({&#39;and&#39;, &#39;pasta&#39;}),
 frozenset({&#39;pasta&#39;, &#39;tomato&#39;}),
 frozenset({&#39;herb&#39;, &#39;sauce&#39;}),
 frozenset({&#39;and&#39;, &#39;herb&#39;}),
 frozenset({&#39;herb&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;sauce&#39;}),
 frozenset({&#39;sauce&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;tomato&#39;}),
 frozenset({&#39;herb&#39;, &#39;pasta&#39;, &#39;sauce&#39;}),
 frozenset({&#39;and&#39;, &#39;herb&#39;, &#39;pasta&#39;}),
 frozenset({&#39;herb&#39;, &#39;pasta&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;pasta&#39;, &#39;sauce&#39;}),
 frozenset({&#39;pasta&#39;, &#39;sauce&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;pasta&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;herb&#39;, &#39;sauce&#39;}),
 frozenset({&#39;herb&#39;, &#39;sauce&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;herb&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;sauce&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;herb&#39;, &#39;pasta&#39;, &#39;sauce&#39;}),
 frozenset({&#39;herb&#39;, &#39;pasta&#39;, &#39;sauce&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;herb&#39;, &#39;pasta&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;pasta&#39;, &#39;sauce&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;herb&#39;, &#39;sauce&#39;, &#39;tomato&#39;}),
 frozenset({&#39;and&#39;, &#39;herb&#39;, &#39;pasta&#39;, &#39;sauce&#39;, &#39;tomato&#39;})]</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[29]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">candidates</span><span class="p">(</span><span class="n">to_ingredient</span><span class="p">(</span><span class="s1">&#39;knorr chicken flavor bouillon cube&#39;</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[29]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>[frozenset({&#39;flavor&#39;}),
 frozenset({&#39;chicken&#39;}),
 frozenset({&#39;cube&#39;}),
 frozenset({&#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;}),
 frozenset({&#39;chicken&#39;, &#39;flavor&#39;}),
 frozenset({&#39;cube&#39;, &#39;flavor&#39;}),
 frozenset({&#39;flavor&#39;, &#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;flavor&#39;}),
 frozenset({&#39;chicken&#39;, &#39;cube&#39;}),
 frozenset({&#39;chicken&#39;, &#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;chicken&#39;}),
 frozenset({&#39;cube&#39;, &#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;cube&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;knorr&#39;}),
 frozenset({&#39;chicken&#39;, &#39;cube&#39;, &#39;flavor&#39;}),
 frozenset({&#39;chicken&#39;, &#39;flavor&#39;, &#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;chicken&#39;, &#39;flavor&#39;}),
 frozenset({&#39;cube&#39;, &#39;flavor&#39;, &#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;cube&#39;, &#39;flavor&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;flavor&#39;, &#39;knorr&#39;}),
 frozenset({&#39;chicken&#39;, &#39;cube&#39;, &#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;chicken&#39;, &#39;cube&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;chicken&#39;, &#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;cube&#39;, &#39;knorr&#39;}),
 frozenset({&#39;chicken&#39;, &#39;cube&#39;, &#39;flavor&#39;, &#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;chicken&#39;, &#39;cube&#39;, &#39;flavor&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;chicken&#39;, &#39;flavor&#39;, &#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;cube&#39;, &#39;flavor&#39;, &#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;chicken&#39;, &#39;cube&#39;, &#39;knorr&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;chicken&#39;, &#39;cube&#39;, &#39;flavor&#39;, &#39;knorr&#39;})]</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>The final step is to compute probabilities of candidate words. This is done using a counter of ingredients: the higher the count, the higher its probability (we don't bother normalizing here).</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[31]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">all_ingredients</span><span class="p">)</span>

<span class="n">c</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[31]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>[(frozenset({&#39;salt&#39;}), 18049),
 (frozenset({&#39;oil&#39;, &#39;olive&#39;}), 7972),
 (frozenset({&#39;onions&#39;}), 7972),
 (frozenset({&#39;water&#39;}), 7457),
 (frozenset({&#39;garlic&#39;}), 7380),
 (frozenset({&#39;sugar&#39;}), 6434),
 (frozenset({&#39;cloves&#39;, &#39;garlic&#39;}), 6237),
 (frozenset({&#39;butter&#39;}), 4848),
 (frozenset({&#39;black&#39;, &#39;ground&#39;, &#39;pepper&#39;}), 4785),
 (frozenset({&#39;all-purpose&#39;, &#39;flour&#39;}), 4632),
 (frozenset({&#39;pepper&#39;}), 4438),
 (frozenset({&#39;oil&#39;, &#39;vegetable&#39;}), 4385),
 (frozenset({&#39;eggs&#39;}), 3388),
 (frozenset({&#39;sauce&#39;, &#39;soy&#39;}), 3296),
 (frozenset({&#39;kosher&#39;, &#39;salt&#39;}), 3113),
 (frozenset({&#39;green&#39;, &#39;onions&#39;}), 3078),
 (frozenset({&#39;tomatoes&#39;}), 3058),
 (frozenset({&#39;eggs&#39;, &#39;large&#39;}), 2948),
 (frozenset({&#39;carrots&#39;}), 2814),
 (frozenset({&#39;butter&#39;, &#39;unsalted&#39;}), 2782)]</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Now we're all set to compute the best candidate for a given input.</p>
<p>First, let's build the probability evaluation for a possible ingredient using a default dict (so that we don't end up asking for an ingredient that doesn't exist):</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[32]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="n">probability</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">most_common</span><span class="p">())</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's test the probability:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[33]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">probability</span><span class="p">[</span><span class="n">to_ingredient</span><span class="p">(</span><span class="s1">&#39;pasta and herb&#39;</span><span class="p">)]</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[33]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>1</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[34]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">probability</span><span class="p">[</span><span class="n">to_ingredient</span><span class="p">(</span><span class="s1">&#39;tomato sauce&#39;</span><span class="p">)]</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[34]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>867</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Seems like what we expect: tomato sauce has a higher probability than pasta and herb, which doesn't appear in our initial words.</p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's now write the function that yields the most probable replacement ingredient among all possible candidates.</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[35]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">best_replacement</span><span class="p">(</span><span class="n">ingredient</span><span class="p">):</span>
    <span class="s2">&quot;Computes best replacement ingredient for a given input.&quot;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">candidates</span><span class="p">(</span><span class="n">ingredient</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">probability</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's now look at some examples:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[36]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">best_replacement</span><span class="p">(</span><span class="n">to_ingredient</span><span class="p">(</span><span class="s2">&quot;tomato sauce&quot;</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[36]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>frozenset({&#39;sauce&#39;, &#39;tomato&#39;})</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[37]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">best_replacement</span><span class="p">(</span><span class="n">to_ingredient</span><span class="p">(</span><span class="s2">&quot;pasta and herb&quot;</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[37]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>frozenset({&#39;pasta&#39;})</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[38]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">best_replacement</span><span class="p">(</span><span class="n">to_ingredient</span><span class="p">(</span><span class="s2">&quot;kraft mexican style shredded four cheese with a touch of philadelphia&quot;</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[38]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>frozenset({&#39;cheese&#39;})</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>These examples all look good. What about the less frequent ingredients we had in our data?</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[53]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">text</span><span class="p">,</span> 
               <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">best_replacement</span><span class="p">(</span><span class="n">to_ingredient</span><span class="p">(</span><span class="n">text</span><span class="p">))))</span> 
              <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_ingredients_text</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]],</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;original ingredient&#39;</span><span class="p">,</span> <span class="s1">&#39;improved ingredient&#39;</span><span class="p">])</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[53]:</div>



<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>original ingredient</th>
      <th>improved ingredient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>pillsbury™ crescent recipe creations® refriger...</td>
      <td>dough</td>
    </tr>
    <tr>
      <th>1</th>
      <td>kraft mexican style shredded four cheese with ...</td>
      <td>cheese</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bertolli vineyard premium collect marinara wit...</td>
      <td>wine</td>
    </tr>
    <tr>
      <th>3</th>
      <td>kraft shredded pepper jack cheese with a touch...</td>
      <td>pepper</td>
    </tr>
    <tr>
      <th>4</th>
      <td>hidden valley® farmhouse originals italian wit...</td>
      <td>herbs</td>
    </tr>
    <tr>
      <th>5</th>
      <td>hidden valley® original ranch salad® dressing ...</td>
      <td>seasoning</td>
    </tr>
    <tr>
      <th>6</th>
      <td>condensed reduced fat reduced sodium cream of ...</td>
      <td>cream</td>
    </tr>
    <tr>
      <th>7</th>
      <td>hellmannâ€™ or best food canola cholesterol fr...</td>
      <td>canola</td>
    </tr>
    <tr>
      <th>8</th>
      <td>condensed reduced fat reduced sodium cream of ...</td>
      <td>chicken</td>
    </tr>
    <tr>
      <th>9</th>
      <td>i can't believ it' not butter! made with olive...</td>
      <td>oil olive</td>
    </tr>
    <tr>
      <th>10</th>
      <td>wish-bone light asian sesame ginger vinaigrett...</td>
      <td>ginger</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(10 oz.) frozen chopped spinach, thawed and sq...</td>
      <td>spinach</td>
    </tr>
    <tr>
      <th>12</th>
      <td>kraft mexican style 2% milk finely shredded fo...</td>
      <td>milk</td>
    </tr>
    <tr>
      <th>13</th>
      <td>kraft shredded low-moisture part-skim mozzarel...</td>
      <td>mozzarella cheese shredded</td>
    </tr>
    <tr>
      <th>14</th>
      <td>hurst family harvest chipotle lime black bean ...</td>
      <td>lime</td>
    </tr>
    <tr>
      <th>15</th>
      <td>reduced fat reduced sodium tomato and herb pas...</td>
      <td>sauce tomato</td>
    </tr>
    <tr>
      <th>16</th>
      <td>frozen orange juice concentrate, thawed and un...</td>
      <td>orange</td>
    </tr>
    <tr>
      <th>17</th>
      <td>crystal farms reduced fat shredded marble jack...</td>
      <td>cheese</td>
    </tr>
    <tr>
      <th>18</th>
      <td>i can't believe it's not butter!® all purpose ...</td>
      <td>believe can't butter!® purpose it's not all st...</td>
    </tr>
    <tr>
      <th>19</th>
      <td>sargento® traditional cut shredded mozzarella ...</td>
      <td>mozzarella cheese shredded</td>
    </tr>
    <tr>
      <th>20</th>
      <td>lipton sparkling diet green tea with strawberr...</td>
      <td>kiwi</td>
    </tr>
    <tr>
      <th>21</th>
      <td>sargento® traditional cut shredded 4 cheese me...</td>
      <td>cheese</td>
    </tr>
    <tr>
      <th>22</th>
      <td>hidden valley® original ranch® spicy ranch dre...</td>
      <td>ranch dressing</td>
    </tr>
    <tr>
      <th>23</th>
      <td>hidden valley® greek yogurt original ranch® di...</td>
      <td>greek yogurt</td>
    </tr>
    <tr>
      <th>24</th>
      <td>conimex woksaus specials vietnamese gember kno...</td>
      <td>woksaus</td>
    </tr>
    <tr>
      <th>25</th>
      <td>honeysuckle white® hot italian turkey sausage ...</td>
      <td>sausage italian</td>
    </tr>
    <tr>
      <th>26</th>
      <td>ragu old world style sweet tomato basil pasta ...</td>
      <td>pasta</td>
    </tr>
    <tr>
      <th>27</th>
      <td>sargento® artisan blends® shredded parmesan ch...</td>
      <td>parmesan cheese</td>
    </tr>
    <tr>
      <th>28</th>
      <td>reduced fat reduced sodium cream of mushroom soup</td>
      <td>cream</td>
    </tr>
    <tr>
      <th>29</th>
      <td>frozen lemonade concentrate, thawed and undiluted</td>
      <td>frozen lemonade concentrate</td>
    </tr>
    <tr>
      <th>30</th>
      <td>reduced sodium reduced fat cream of mushroom soup</td>
      <td>cream</td>
    </tr>
    <tr>
      <th>31</th>
      <td>condensed reduced fat reduced sodium tomato soup</td>
      <td>fat</td>
    </tr>
    <tr>
      <th>32</th>
      <td>shredded reduced fat reduced sodium swiss cheese</td>
      <td>cheese</td>
    </tr>
    <tr>
      <th>33</th>
      <td>knorr reduc sodium chicken flavor bouillon cube</td>
      <td>chicken</td>
    </tr>
    <tr>
      <th>34</th>
      <td>2 1/2 to 3 lb. chicken, cut into serving pieces</td>
      <td>chicken</td>
    </tr>
    <tr>
      <th>35</th>
      <td>kraft mexican style finely shredded four cheese</td>
      <td>cheese</td>
    </tr>
    <tr>
      <th>36</th>
      <td>frozen chopped spinach, thawed and squeezed dry</td>
      <td>spinach</td>
    </tr>
    <tr>
      <th>37</th>
      <td>frank's® redhot® original cayenne pepper sauce</td>
      <td>pepper</td>
    </tr>
    <tr>
      <th>38</th>
      <td>reduced sodium condensed cream of chicken soup</td>
      <td>chicken</td>
    </tr>
    <tr>
      <th>39</th>
      <td>foster farms boneless skinless chicken breasts</td>
      <td>breasts boneless skinless chicken</td>
    </tr>
    <tr>
      <th>40</th>
      <td>knorr tomato bouillon with chicken flavor cube</td>
      <td>chicken</td>
    </tr>
    <tr>
      <th>41</th>
      <td>pompeian canola oil and extra virgin olive oil</td>
      <td>oil olive</td>
    </tr>
    <tr>
      <th>42</th>
      <td>hidden valley® original ranch® light dressing</td>
      <td>dressing</td>
    </tr>
    <tr>
      <th>43</th>
      <td>uncle ben's ready rice whole grain brown rice</td>
      <td>rice</td>
    </tr>
    <tr>
      <th>44</th>
      <td>soy vay® veri veri teriyaki® marinade &amp; sauce</td>
      <td>soy sauce</td>
    </tr>
    <tr>
      <th>45</th>
      <td>taco bell® home originals® taco seasoning mix</td>
      <td>seasoning taco</td>
    </tr>
    <tr>
      <th>46</th>
      <td>pillsbury™ refrigerated crescent dinner rolls</td>
      <td>rolls</td>
    </tr>
    <tr>
      <th>47</th>
      <td>kraft reduced fat shredded mozzarella cheese</td>
      <td>mozzarella cheese shredded</td>
    </tr>
    <tr>
      <th>48</th>
      <td>reduced sodium italian style stewed tomatoes</td>
      <td>tomatoes</td>
    </tr>
    <tr>
      <th>49</th>
      <td>skinless and boneless chicken breast fillet</td>
      <td>chicken</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>This is interesting: a lot of the ingredients get well simplified, which is exactly what we want. Two comments:</p>
<ul>
<li>some simplifications are not the ones expected <em>i can't believe it's not butter!® all purpose sticks</em>, <em>reduced sodium reduced fat cream of mushroom soup</em></li>
<li>some get simplified <strong>too much</strong>: <em>skinless and boneless chicken breast fillet</em> becomes <em>chicken</em>, <em>reduced sodium italian style stewed tomatoes</em> becomes <em>tomatoes</em></li>
</ul>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>This model fails to take into account one thing: if we leave out too many ingredients in our replacement ingredient, the distance to the original ingredient increases. This observation is analogous to Peter Norvig's spell checker, where he considers the possible candidates by increasing edit distance: first words that have only one modification compared to the original word, then two modifications, then three...</p>
<p>To compensate for this oversimplifcation, let's modify our procedure to keep a new ingredient that is as close as possible to the original.</p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Building-a-slightly-more-elaborate-model">Building a slightly more elaborate model<a class="anchor-link" href="#Building-a-slightly-more-elaborate-model">&#182;</a></h1>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>The only thing we have to change is the way our candidates function works. Instead of generating all possibilites it should return only the ones that exist in our vocabulary of recipes with the least possible number of modifications. Here the modifications can be thought of leaving out a given number of words, by increasing the number of words left out.</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[40]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">candidates_increasing_distance</span><span class="p">(</span><span class="n">ingredient</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">):</span>
    <span class="s2">&quot;Returns candidate ingredients obtained from the original ingredient by substraction, largest number of ingredients first.&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ingredient</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">possible</span> <span class="o">=</span> <span class="p">[</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">combi</span><span class="p">)</span> <span class="k">for</span> <span class="n">combi</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">ingredient</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> 
                    <span class="k">if</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">combi</span><span class="p">)</span> <span class="ow">in</span> <span class="n">vocabulary</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">possible</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">ingredient</span><span class="p">]</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>We will define our vocabulary by the already existing counted ingredients:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[41]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vocabulary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">most_common</span><span class="p">())</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[42]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">vocabulary</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[42]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>[frozenset({&#39;chicken&#39;, &#39;cubes&#39;, &#39;stock&#39;}),
 frozenset({&#39;creations®&#39;,
            &#39;crescent&#39;,
            &#39;dough&#39;,
            &#39;pillsbury™&#39;,
            &#39;recipe&#39;,
            &#39;refrigerated&#39;,
            &#39;seamless&#39;,
            &#39;sheet&#39;}),
 frozenset({&#39;nori&#39;, &#39;shredded&#39;}),
 frozenset({&#39;eye&#39;, &#39;of&#39;, &#39;roast&#39;, &#39;round&#39;}),
 frozenset({&#39;gumbo&#39;, &#39;mixture&#39;, &#39;vegetable&#39;}),
 frozenset({&#39;curry&#39;, &#39;green&#39;, &#39;paste&#39;, &#39;thai&#39;}),
 frozenset({&#39;bouillon&#39;, &#39;chicken&#39;, &#39;cube&#39;, &#39;flavor&#39;, &#39;knorr&#39;}),
 frozenset({&#39;beef&#39;, &#39;roast&#39;, &#39;shoulder&#39;}),
 frozenset({&#39;grained&#39;}),
 frozenset({&#39;dried&#39;, &#39;ear&#39;, &#39;mushrooms&#39;, &#39;wood&#39;})]</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's test our function on a few examples:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[43]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">candidates_increasing_distance</span><span class="p">(</span><span class="n">to_ingredient</span><span class="p">(</span><span class="s2">&quot;bottled clam juice&quot;</span><span class="p">),</span> <span class="n">vocabulary</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[43]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>[frozenset({&#39;clam&#39;, &#39;juice&#39;})]</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[45]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">candidates_increasing_distance</span><span class="p">(</span><span class="n">to_ingredient</span><span class="p">(</span><span class="s1">&#39;hidden valley original ranch spicy ranch dressing&#39;</span><span class="p">),</span> <span class="n">vocabulary</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[45]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>[frozenset({&#39;dressing&#39;, &#39;ranch&#39;})]</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[47]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">candidates_increasing_distance</span><span class="p">(</span><span class="n">to_ingredient</span><span class="p">(</span><span class="s2">&quot;skinless and boneless chicken breast fillet&quot;</span><span class="p">),</span> <span class="n">vocabulary</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[47]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>[frozenset({&#39;boneless&#39;, &#39;breast&#39;, &#39;chicken&#39;, &#39;skinless&#39;})]</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[48]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">candidates_increasing_distance</span><span class="p">(</span><span class="n">to_ingredient</span><span class="p">(</span><span class="s2">&quot;reduced sodium italian style stewed tomatoes&quot;</span><span class="p">),</span> <span class="n">vocabulary</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[48]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>[frozenset({&#39;italian&#39;, &#39;stewed&#39;, &#39;style&#39;, &#39;tomatoes&#39;})]</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>As we see, this works better on the examples that got simplified too much using the previous model.</p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's now write a new function for computing the best replacement, that takes into account the probabilities:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[49]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">best_replacement_increasing_distance</span><span class="p">(</span><span class="n">ingredient</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">):</span>
    <span class="s2">&quot;Computes best replacement ingredient for a given input.&quot;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">candidates_increasing_distance</span><span class="p">(</span><span class="n">ingredient</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">vocabulary</span><span class="p">[</span><span class="n">w</span><span class="p">])</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>And let's apply this to our lesser used ingredients:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[54]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">text</span><span class="p">,</span> 
               <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">best_replacement_increasing_distance</span><span class="p">(</span><span class="n">to_ingredient</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">vocabulary</span><span class="p">)))</span> 
              <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_ingredients_text</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]],</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;original ingredient&#39;</span><span class="p">,</span> <span class="s1">&#39;improved ingredient&#39;</span><span class="p">])</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[54]:</div>



<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>original ingredient</th>
      <th>improved ingredient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>pillsbury™ crescent recipe creations® refriger...</td>
      <td>refrigerated seamless dough crescent</td>
    </tr>
    <tr>
      <th>1</th>
      <td>kraft mexican style shredded four cheese with ...</td>
      <td>cheese shredded</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bertolli vineyard premium collect marinara wit...</td>
      <td>wine marinara bertolli vineyard with burgundi ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>kraft shredded pepper jack cheese with a touch...</td>
      <td>kraft jack pepper cheese shredded</td>
    </tr>
    <tr>
      <th>4</th>
      <td>hidden valley® farmhouse originals italian wit...</td>
      <td>herbs italian</td>
    </tr>
    <tr>
      <th>5</th>
      <td>hidden valley® original ranch salad® dressing ...</td>
      <td>ranch dressing</td>
    </tr>
    <tr>
      <th>6</th>
      <td>condensed reduced fat reduced sodium cream of ...</td>
      <td>mushroom fat cream reduced soup of sodium</td>
    </tr>
    <tr>
      <th>7</th>
      <td>hellmannâ€™ or best food canola cholesterol fr...</td>
      <td>best canola cholesterol mayonnais food or free...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>condensed reduced fat reduced sodium cream of ...</td>
      <td>cream chicken reduced soup condensed of sodium</td>
    </tr>
    <tr>
      <th>9</th>
      <td>i can't believ it' not butter! made with olive...</td>
      <td>oil olive</td>
    </tr>
    <tr>
      <th>10</th>
      <td>wish-bone light asian sesame ginger vinaigrett...</td>
      <td>vinaigrette dressing</td>
    </tr>
    <tr>
      <th>11</th>
      <td>(10 oz.) frozen chopped spinach, thawed and sq...</td>
      <td>chopped frozen spinach thawed squeezed and dry</td>
    </tr>
    <tr>
      <th>12</th>
      <td>kraft mexican style 2% milk finely shredded fo...</td>
      <td>mexican shredded finely style cheese kraft four</td>
    </tr>
    <tr>
      <th>13</th>
      <td>kraft shredded low-moisture part-skim mozzarel...</td>
      <td>kraft mozzarella cheese shredded</td>
    </tr>
    <tr>
      <th>14</th>
      <td>hurst family harvest chipotle lime black bean ...</td>
      <td>bean soup mix</td>
    </tr>
    <tr>
      <th>15</th>
      <td>reduced fat reduced sodium tomato and herb pas...</td>
      <td>sauce tomato</td>
    </tr>
    <tr>
      <th>16</th>
      <td>frozen orange juice concentrate, thawed and un...</td>
      <td>orange frozen juice concentrate</td>
    </tr>
    <tr>
      <th>17</th>
      <td>crystal farms reduced fat shredded marble jack...</td>
      <td>cheese reduced shredded fat</td>
    </tr>
    <tr>
      <th>18</th>
      <td>i can't believe it's not butter!® all purpose ...</td>
      <td>believe can't butter!® sticks not it's all i p...</td>
    </tr>
    <tr>
      <th>19</th>
      <td>sargento® traditional cut shredded mozzarella ...</td>
      <td>mozzarella cheese shredded</td>
    </tr>
    <tr>
      <th>20</th>
      <td>lipton sparkling diet green tea with strawberr...</td>
      <td>tea green</td>
    </tr>
    <tr>
      <th>21</th>
      <td>sargento® traditional cut shredded 4 cheese me...</td>
      <td>cheese shredded</td>
    </tr>
    <tr>
      <th>22</th>
      <td>hidden valley® original ranch® spicy ranch dre...</td>
      <td>hidden valley® ranch® original dressing</td>
    </tr>
    <tr>
      <th>23</th>
      <td>hidden valley® greek yogurt original ranch® di...</td>
      <td>greek yogurt</td>
    </tr>
    <tr>
      <th>24</th>
      <td>conimex woksaus specials vietnamese gember kno...</td>
      <td>woksaus specials knoflook gember conimex vietn...</td>
    </tr>
    <tr>
      <th>25</th>
      <td>honeysuckle white® hot italian turkey sausage ...</td>
      <td>hot sausage turkey italian links</td>
    </tr>
    <tr>
      <th>26</th>
      <td>ragu old world style sweet tomato basil pasta ...</td>
      <td>pasta world old ragu style sauc</td>
    </tr>
    <tr>
      <th>27</th>
      <td>sargento® artisan blends® shredded parmesan ch...</td>
      <td>parmesan cheese shredded</td>
    </tr>
    <tr>
      <th>28</th>
      <td>reduced fat reduced sodium cream of mushroom soup</td>
      <td>mushroom fat cream reduced soup of</td>
    </tr>
    <tr>
      <th>29</th>
      <td>frozen lemonade concentrate, thawed and undiluted</td>
      <td>frozen lemonade concentrate</td>
    </tr>
    <tr>
      <th>30</th>
      <td>reduced sodium reduced fat cream of mushroom soup</td>
      <td>mushroom fat cream reduced soup of</td>
    </tr>
    <tr>
      <th>31</th>
      <td>condensed reduced fat reduced sodium tomato soup</td>
      <td>condensed soup tomato</td>
    </tr>
    <tr>
      <th>32</th>
      <td>shredded reduced fat reduced sodium swiss cheese</td>
      <td>swiss reduced cheese fat</td>
    </tr>
    <tr>
      <th>33</th>
      <td>knorr reduc sodium chicken flavor bouillon cube</td>
      <td>bouillon reduc flavor knorr chicken sodium</td>
    </tr>
    <tr>
      <th>34</th>
      <td>2 1/2 to 3 lb. chicken, cut into serving pieces</td>
      <td>pieces chicken</td>
    </tr>
    <tr>
      <th>35</th>
      <td>kraft mexican style finely shredded four cheese</td>
      <td>cheese shredded</td>
    </tr>
    <tr>
      <th>36</th>
      <td>frozen chopped spinach, thawed and squeezed dry</td>
      <td>chopped frozen spinach</td>
    </tr>
    <tr>
      <th>37</th>
      <td>frank's® redhot® original cayenne pepper sauce</td>
      <td>pepper cayenne sauce</td>
    </tr>
    <tr>
      <th>38</th>
      <td>reduced sodium condensed cream of chicken soup</td>
      <td>condensed soup cream chicken of</td>
    </tr>
    <tr>
      <th>39</th>
      <td>foster farms boneless skinless chicken breasts</td>
      <td>breasts boneless skinless chicken</td>
    </tr>
    <tr>
      <th>40</th>
      <td>knorr tomato bouillon with chicken flavor cube</td>
      <td>bouillon tomato with flavor knorr chicken</td>
    </tr>
    <tr>
      <th>41</th>
      <td>pompeian canola oil and extra virgin olive oil</td>
      <td>oil virgin olive</td>
    </tr>
    <tr>
      <th>42</th>
      <td>hidden valley® original ranch® light dressing</td>
      <td>hidden valley® ranch® original dressing</td>
    </tr>
    <tr>
      <th>43</th>
      <td>uncle ben's ready rice whole grain brown rice</td>
      <td>whole grain rice</td>
    </tr>
    <tr>
      <th>44</th>
      <td>soy vay® veri veri teriyaki® marinade &amp; sauce</td>
      <td>soy sauce</td>
    </tr>
    <tr>
      <th>45</th>
      <td>taco bell® home originals® taco seasoning mix</td>
      <td>seasoning taco mix</td>
    </tr>
    <tr>
      <th>46</th>
      <td>pillsbury™ refrigerated crescent dinner rolls</td>
      <td>refrigerated rolls crescent</td>
    </tr>
    <tr>
      <th>47</th>
      <td>kraft reduced fat shredded mozzarella cheese</td>
      <td>cheese reduced shredded fat</td>
    </tr>
    <tr>
      <th>48</th>
      <td>reduced sodium italian style stewed tomatoes</td>
      <td>tomatoes style italian stewed</td>
    </tr>
    <tr>
      <th>49</th>
      <td>skinless and boneless chicken breast fillet</td>
      <td>skinless breast chicken boneless</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>This result is interesting: the refined labels given here seem much better than the originals. However, there are still problems with the new ingredients. In particular, special symbols pollute the data. Therefore it's a good idea to first clean the data before employing our method.</p>
<p>Hopefully, this leads us to a better ingredient names, leading to better classification. To assert this, we'll train again on the dataset and see if we can expect some improvement compared to our previous model.</p>

</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Training-a-machine-learning-model">Training a machine learning model<a class="anchor-link" href="#Training-a-machine-learning-model">&#182;</a></h1>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>First, let's train the <a href="http://flothesof.github.io/kaggle-whats-cooking-machine-learning.html">previous model</a>:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[55]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;all_ingredients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;ingredients&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;all_ingredients&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="n">enc</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">cuisine</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's evaluate the accuracy of our model by doing a K-fold cross validation (training the model several times and check the error each time).</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[56]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">sem</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">def</span> <span class="nf">evaluate_cross_validation</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
    <span class="c1"># create a k-fold cross validation iterator</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">K</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># by default the score used is the one returned by score method of the estimator (accuracy)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">scores</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Mean score: </span><span class="si">{0:.3f}</span><span class="s2"> (+/-</span><span class="si">{1:.3f}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span> <span class="n">sem</span><span class="p">(</span><span class="n">scores</span><span class="p">)))</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[57]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="n">logistic</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">evaluate_cross_validation</span><span class="p">(</span><span class="n">logistic</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>[ 0.79195475  0.78830924  0.78290383  0.79019485  0.78124214]
Mean score: 0.787 (+/-0.002)
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Now that we have an initial evaluation of our algorithm, let's feed it our better vectors. All we have to do is rebuild the X matrix using our new feature ingredients. We also perform some string substitution to take into account the special characters.</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[63]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">clean_string</span><span class="p">(</span><span class="n">ingredient_text</span><span class="p">):</span>
    <span class="s2">&quot;Cleans the ingredient from special characters and returns it as lowercase.&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">ingredient_text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">char</span><span class="o">.</span><span class="n">isspace</span><span class="p">()])</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's test this:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[64]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_string</span><span class="p">(</span><span class="s2">&quot;frank&#39;s® redhot® original cayenne pepper sauce&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[64]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>&#39;franks redhot original cayenne pepper sauce&#39;</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[65]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_string</span><span class="p">(</span><span class="s2">&quot;2 1/2 to 3 lb. chicken, cut into serving pieces&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[65]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>&#39;2 12 to 3 lb chicken cut into serving pieces&#39;</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[66]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_string</span><span class="p">(</span><span class="s2">&quot;i can&#39;t believe it&#39;s not butter!® all purpose sticks&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[66]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>&#39;i cant believe its not butter all purpose sticks&#39;</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[93]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_string</span><span class="p">(</span><span class="s2">&quot;extra-virgin olive oil&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[93]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>&#39;extravirgin olive oil&#39;</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Finally, we can put together our function for improving a list of ingredients from the dataframe. We'll use a treshold for improving ingredients because very popular ingredients should just stay the same and not get cleaned. To do this, let's plot a graph for the value counts of the different ingredients found:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[78]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;bmh&#39;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[81]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[81]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1e49b438&gt;</pre>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>




<div class="jp-RenderedImage jp-OutputArea-output ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>This gives us a criterion: let's only improved ingredients whose counts are lower 100. The others are assumed to be already well defined.</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[94]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">improve_ingredients</span><span class="p">(</span><span class="n">ingredient_list</span><span class="p">):</span>
    <span class="s2">&quot;Improves the list of ingredients given as input.&quot;</span>
    <span class="n">better_ingredients</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ingredient</span> <span class="ow">in</span> <span class="n">ingredient_list</span><span class="p">:</span>
        <span class="n">cleaned_ingredient</span> <span class="o">=</span> <span class="n">clean_string</span><span class="p">(</span><span class="n">ingredient</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vocabulary</span><span class="p">[</span><span class="n">to_ingredient</span><span class="p">(</span><span class="n">cleaned_ingredient</span><span class="p">)]</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">better_ingredients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">best_replacement_increasing_distance</span><span class="p">(</span>
                                        <span class="n">to_ingredient</span><span class="p">(</span><span class="n">cleaned_ingredient</span><span class="p">),</span> <span class="n">vocabulary</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">better_ingredients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cleaned_ingredient</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">better_ingredients</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Before using our function, we also need to rebuild our vocabulary using our new string cleaning function:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[95]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;test.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<span class="n">all_ingredients_text</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="p">[</span><span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">ingredient_list</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
        <span class="n">all_ingredients_text</span> <span class="o">+=</span> <span class="p">[</span><span class="n">clean_string</span><span class="p">(</span><span class="n">ing</span><span class="p">)</span> <span class="k">for</span> <span class="n">ing</span> <span class="ow">in</span> <span class="n">ingredient_list</span><span class="p">]</span>
<span class="n">all_ingredients</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_ingredient</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">all_ingredients_text</span><span class="p">]</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">all_ingredients</span><span class="p">)</span>
<span class="n">vocabulary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">most_common</span><span class="p">())</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[96]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;better_ingredients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;ingredients&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">improve_ingredients</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[97]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[97]:</div>



<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cuisine</th>
      <th>id</th>
      <th>ingredients</th>
      <th>all_ingredients</th>
      <th>better_ingredients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>greek</td>
      <td>10259</td>
      <td>[romaine lettuce, black olives, grape tomatoes...</td>
      <td>romaine lettuce;black olives;grape tomatoes;ga...</td>
      <td>romaine lettuce;black olives;grape tomatoes;ga...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>southern_us</td>
      <td>25693</td>
      <td>[plain flour, ground pepper, salt, tomatoes, g...</td>
      <td>plain flour;ground pepper;salt;tomatoes;ground...</td>
      <td>plain flour;ground pepper;salt;tomatoes;ground...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>filipino</td>
      <td>20130</td>
      <td>[eggs, pepper, salt, mayonaise, cooking oil, g...</td>
      <td>eggs;pepper;salt;mayonaise;cooking oil;green c...</td>
      <td>eggs;pepper;salt;mayonaise;cooking oil;green c...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>indian</td>
      <td>22213</td>
      <td>[water, vegetable oil, wheat, salt]</td>
      <td>water;vegetable oil;wheat;salt</td>
      <td>water;vegetable oil;wheat;salt</td>
    </tr>
    <tr>
      <th>4</th>
      <td>indian</td>
      <td>13162</td>
      <td>[black pepper, shallots, cornflour, cayenne pe...</td>
      <td>black pepper;shallots;cornflour;cayenne pepper...</td>
      <td>black pepper;shallots;cornflour;cayenne pepper...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>jamaican</td>
      <td>6602</td>
      <td>[plain flour, sugar, butter, eggs, fresh ginge...</td>
      <td>plain flour;sugar;butter;eggs;fresh ginger roo...</td>
      <td>plain flour;sugar;butter;eggs;fresh ginger roo...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>spanish</td>
      <td>42779</td>
      <td>[olive oil, salt, medium shrimp, pepper, garli...</td>
      <td>olive oil;salt;medium shrimp;pepper;garlic;cho...</td>
      <td>olive oil;salt;medium shrimp;pepper;garlic;cho...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>italian</td>
      <td>3735</td>
      <td>[sugar, pistachio nuts, white almond bark, flo...</td>
      <td>sugar;pistachio nuts;white almond bark;flour;v...</td>
      <td>sugar;nuts pistachio;white bark almond;flour;v...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>mexican</td>
      <td>16903</td>
      <td>[olive oil, purple onion, fresh pineapple, por...</td>
      <td>olive oil;purple onion;fresh pineapple;pork;po...</td>
      <td>olive oil;purple onion;fresh pineapple;pork;po...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>italian</td>
      <td>12734</td>
      <td>[chopped tomatoes, fresh basil, garlic, extra-...</td>
      <td>chopped tomatoes;fresh basil;garlic;extra-virg...</td>
      <td>chopped tomatoes;fresh basil;garlic;extravirgi...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's now see the performance of this new version of the ingredients.</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[98]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;better_ingredients&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[99]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">evaluate_cross_validation</span><span class="p">(</span><span class="n">logistic</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>[ 0.78830924  0.78680075  0.78214959  0.78918919  0.77923058]
Mean score: 0.785 (+/-0.002)
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Well that's too bad... Our "clever" ingredients don't improve our score on the test set. Still let's try to submit a solution given that the test data might have some other issues (unknown ingredients that our method can simplify...).</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[100]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;better_ingredients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;ingredients&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">improve_ingredients</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>And now, let's build our feature matrix:</p>

</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[101]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_submit</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;better_ingredients&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[102]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">logistic</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[102]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>LogisticRegression(C=1.0, class_weight=None, dual=False, fit_intercept=True,
          intercept_scaling=1, max_iter=100, multi_class=&#39;ovr&#39;, n_jobs=1,
          penalty=&#39;l2&#39;, random_state=None, solver=&#39;liblinear&#39;, tol=0.0001,
          verbose=0, warm_start=False)</pre>
</div>

</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[103]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_submit</span> <span class="o">=</span> <span class="n">logistic</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_submit</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[104]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;submission_better_words.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;id,cuisine</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cuisine</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_test</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">enc</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_submit</span><span class="p">)):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cuisine</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Conclusion">Conclusion<a class="anchor-link" href="#Conclusion">&#182;</a></h1>
</div>
</div>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>My submission (to the already closed contest) achieves a ranking of 576th, nothing to frill about. That's too bad. I would have hoped it would somehow improve my score, even though the K-fold had shown worse performance. Nevertheless, I think what is valuable here is that we have devised a way to improve a given text feature vector by using simple probability. This technique might be useful in other machine learning settings, when one can't trust the absolute reliability of the data. As demonstrated on the most exotic ingredients found in the dataset, this method can perform very well and transform an ingredient that is quite exotic into something that still makes sense.</p>

</div>
</div>



<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
        </div>

        <div class="meta">
            <hr>
                <p>This article has been tagged with the following terms:</p>
            <div>
                    <a href="http://flothesof.github.io/tag/machine-learning.html" class="tag">Machine Learning</a>
                    <a href="http://flothesof.github.io/tag/probability.html" class="tag">Probability</a>
            </div>
            <hr>
            <div class="share">
                <ul>
                    <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://flothesof.github.io/probabilistic-ingredients.html&amp;t=A Probabilistic Model for Ingredients in the Kaggle What's Cooking Challenge" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Share on Facebook" src="/theme/social_flat_rounded_rects_svg/Facebook.svg"></a><a></a></li>
                    <li><a href="https://twitter.com/share?url=http://flothesof.github.io/probabilistic-ingredients.html&amp;text=A Probabilistic Model for Ingredients in the Kaggle What's Cooking Challenge&amp;via=frolianlb" title="Tweet" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Tweet" src="/theme/social_flat_rounded_rects_svg/Twitter.svg"></a><a></a></li>
                    <li><a href="https://getpocket.com/save?url=http://flothesof.github.io/probabilistic-ingredients.html&amp;title=A Probabilistic Model for Ingredients in the Kaggle What's Cooking Challenge" title="Add to Pocket" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Add to Pocket" src="/theme/social_flat_rounded_rects_svg/Pocket.svg"></a><a></a></li>
                    <li><a href="https://news.ycombinator.com/submitlink?u=http://flothesof.github.io/probabilistic-ingredients.html&amp;t=A Probabilistic Model for Ingredients in the Kaggle What's Cooking Challenge" title="Submit to Hacker News" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Submit to Hacker News" src="/theme/social_flat_rounded_rects_svg/HackerNews.svg"></a><a></a></li>
                    <li><a href="https://www.reddit.com/submit?url=http://flothesof.github.io/probabilistic-ingredients.html&amp;title=A Probabilistic Model for Ingredients in the Kaggle What's Cooking Challenge" title="Submit to Reddit" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Submit to Reddit" src="/theme/social_flat_rounded_rects_svg/Reddit.svg"></a><a></a></li>
                </ul>
            </div>
            <hr>
        </div>
    </article>

  <section>
        <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
    <script type="text/javascript">
      var disqus_shortname = 'froliansblog';
      var disqus_identifier = '/probabilistic-ingredients.html';
      var disqus_url = 'http://flothesof.github.io/probabilistic-ingredients.html';
      var disqus_title = 'A Probabilistic Model for Ingredients in the Kaggle What\'s Cooking Challenge';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  </section>

</div>

<style type="text/css">
{
    max-width: 800px;
}

.text_cell .prompt {
    display: none;
}

div.cell {
    padding: 0;
}

div.text_cell_render {
    padding: 0;
}

div.prompt {
    font-size: 13px;
}

div.input_prompt {
    padding: .7em 0.2em;
}

div.output_prompt {
    padding: .4em .2em;
}

div.input_area {
    margin: .2em 0.4em;
}

table.dataframe {
    font-family: Arial, sans-serif;
    font-size: 13px;
    line-height: 20px;
}

table.dataframe th, td {
    padding: 4px;
    text-align: left;
}

pre code {
    background-color: inherit;
}</style>

        </div>
<!--
    <footer>
      <p>
        © 2012-2017 Florian Le Bourdais, license <a href=""> </a>
        unless otherwise noted.
        Generated by <a href= "http://docs.getpelican.com/">Pelican</a>.
      </p>
    </footer>
-->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-68753870-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-68753870-1');
    ga('send', 'pageview');
</script>
    </body>
</html>